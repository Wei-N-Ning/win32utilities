"""
spec:

          4 bytes                     4 bytes
length of module buffer | length of decipher function buffer | cipher function buffer | module buffer


examples:

_buf = resources.read(file_path)
_buf[0:4]
"""


import json
import marshal
import types
import unittest


class TestRunMaliciousCode(unittest.TestCase):

    def test_loadFunctionObjectFromBytes(self):
        _buf = \
            '\x63\x00\x00\x00\x00\x01\x00\x00\x00\x04\x00\x00\x00\x43\x00\x00\x00\x73\x2e\x00\x00\x00\x64\x01\x00\x64' \
           '\x00\x00\x6c\x00\x00\x7d\x00\x00\x7c\x00\x00\x6a\x01\x00\x69\x03\x00\x74\x02\x00\x64\x02\x00\x36\x64\x03' \
           '\x00\x64\x04\x00\x36\x64\x05\x00\x64\x06\x00\x36\x83\x01\x00\x53\x28\x07\x00\x00\x00\x4e\x69\xff\xff\xff' \
           '\xff\x73\x0e\x00\x00\x00\x74\x68\x69\x73\x20\x69\x73\x20\x61\x20\x6a\x6f\x6b\x65\x73\x09\x00\x00\x00\x75' \
           '\x67\x67\x20\x62\x6f\x6f\x74\x73\x73\x0b\x00\x00\x00\x74\x69\x67\x68\x74\x20\x6a\x65\x61\x6e\x73\x67\xcd' \
           '\xcc\xcc\xcc\xcc\x4c\x35\x40\x74\x03\x00\x00\x00\x61\x67\x65\x28\x03\x00\x00\x00\x74\x04\x00\x00\x00\x6a' \
           '\x73\x6f\x6e\x74\x05\x00\x00\x00\x64\x75\x6d\x70\x73\x74\x04\x00\x00\x00\x54\x72\x75\x65\x28\x01\x00\x00' \
           '\x00\x52\x01\x00\x00\x00\x28\x00\x00\x00\x00\x28\x00\x00\x00\x00\x73\x5b\x00\x00\x00\x2f\x77\x6f\x72\x6b' \
           '\x2f\x64\x65\x76\x2f\x70\x79\x74\x68\x6f\x6e\x2f\x67\x69\x74\x68\x75\x62\x2e\x63\x6f\x6d\x2f\x70\x6f\x77' \
           '\x65\x72\x67\x75\x6e\x2f\x77\x69\x6e\x33\x32\x75\x74\x69\x6c\x69\x74\x69\x65\x73\x2f\x74\x65\x73\x74\x73' \
           '\x2f\x73\x65\x63\x75\x72\x69\x74\x79\x2f\x74\x65\x73\x74\x5f\x72\x75\x6e\x4d\x61\x6c\x69\x63\x69\x6f\x75' \
           '\x73\x43\x6f\x64\x65\x2e\x70\x79\x74\x03\x00\x00\x00\x73\x75\x74\x0a\x00\x00\x00\x73\x04\x00\x00\x00\x00' \
           '\x01\x0c\x01'
        c = marshal.loads(_buf)
        f = types.FunctionType(c, globals(), '___')
        r = f()
        d = json.loads(r)
        self.assertAlmostEqual(21.3, d['age'])


if __name__ == '__main__':
    unittest.main()
